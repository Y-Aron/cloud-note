# 开发技巧

### 关于日志配置

> `Ecology`底层采用的是`log4j`日志框架, 可根据环境自定义日志配置

> log4j配置文件路径: `ecology/WEB-INF/log4jinit.properties`

打开配置文件, 在文件末尾加上如下代码, 然后重启`resin`服务

```properties
# appender
log4j.logger.debug=DEBUG,debug
log4j.appender.debug=org.apache.log4j.DailyRollingFileAppender
# 按日期滚动文件
log4j.appender.debug.DatePattern='_'yyyyMMdd'.log'
# 自定义日志文件路径
log4j.appender.debug.File=@debug/debug.log
log4j.appender.debug.layout=org.apache.log4j.PatternLayout
# 输出内容格式
log4j.appender.debug.layout.ConversionPattern=%d{HH:mm:ss.SSS}[%p] %l: %m%n
log4j.additivity.debug=false
```

代码中使用: 

```properties
// 获取自定义的 logger, 其中 debug为配置文件中 log4j.logger.debug中的debug
Logger logger = LoggerFactory.getLogger("debug");
// 支持占位符输出, 不定参数
logger.debug("debug级别消息: {}, {}", "参数1", "参数2");
logger.info("info级别消息!");
logger.warn("warn级别消息!");
logger.error("error级别消息!");
// ...
```

最终日志输出路径:

![image](CA2D31CC6A1947729E35D9D2BA8925D6)

**建议**: 将重要的日志以 `info` 级别以上输出, 开发的日志以 `debug` 级别输出, 这样的话再正式环境下只需修改配置, 即可实现只输出 `info` 级别的日志, 减少日志的输出!

```properties
# 将日志级别提升至INFO
log4j.logger.debug=INFO,debug
```

### 关于远程调试

> 适用于远程服务器可连接情况下

配置`JVM`远程调试参数: `resin\conf\resin.properties`

```properties
# 初始配置
jvm_args  : -Xmx5550m -Xms5550m -XX:ParallelGCThreads=20 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+DisableExplicitGC -javaagent:wagent.jar
# 修改后的配置
jvm_args  : -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=9090 -Xmx5550m -Xms5550m -XX:ParallelGCThreads=20 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+DisableExplicitGC -javaagent:wagent.jar
```

##### 在`IDEA`中使用: 
<img src=".\asset\1570192957176.png" alt="1570192957176"  />

启动后正常打断点即可!

### 配置Redis缓存

- 本地下载`redis`
- `ecology/WEB-INF/prop/weaver_new_session.properties`

```properties
#1表示启用新的session方式，其他值表示不启用
status=1
#用于调试的USERID
debugUsers=
#session id生成模式，1表示自定义生成模式（UUID模式），其他值表示中间件自定义生成模式
useCustomSessionId=1
#同步频率设置（单位，秒）
#主表同步频率
SessionTableSync=2
#明细表同步频率
SessionItemTableSync=5
#超时扫描频率
SessionOverTime=300
#垃圾数据清理扫描频率
SessionLeak=3600

#启动模式，默认是数据库模式
#className=weaver.session.util.DBUtil
className=weaver.session.util.RedisSessionUtil
#redis ip
redisIp=127.0.0.1
#redis port
redisPort=6379
#redis password
redisPassword=123456
enableImmediatelySync=true
etoken=
```